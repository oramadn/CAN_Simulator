import sys
import test_ui
import src
from PySide6.QtWidgets import QApplication, QMainWindow,QTableWidgetItem
from PySide6.QtCore import Slot


class GUI(QMainWindow,test_ui.Ui_MainWindow):
    def __init__(self):
        super().__init__()
        self.setupUi(self)
        self.startButton.clicked.connect(self.start)

    def add_row(self, row_data):
        row_position = self.mainTable.rowCount()
        self.mainTable.insertRow(row_position)
        for column, data in enumerate(row_data):
            item = QTableWidgetItem(str(data))
            self.mainTable.setItem(row_position, column, item)

    @Slot()
    def start(self):
        print('\n\nSTARTED SIMULATION\n\n')
        frameCount = src.promptUser()
        data = src.generateFrames(frameCount)
        
        data_row = []
        for frame in data:
            data_row.append(frame.id)
            for i in range(2, len(frame.data), 2):
                data_row.append("0x" + frame.data[i:i+2])
            data_row_copy = data_row.copy()
            self.add_row(data_row_copy)
            data_row.clear()
        

def main():
    app = QApplication(sys.argv)
    gui = GUI()
    
    gui.show()
    app.exec_()

if __name__ == '__main__':
    main()